# example docker compose override for local development
services:
    drupal:
      secrets:
        - source: CERT_PUBLIC_KEY
        - source: CERT_PRIVATE_KEY
        - source: CERT_AUTHORITY
        - source: UID
      volumes: !override
        - type: volume
          source: drupal-public-files
          target: /var/www/drupal/web/sites/default/files
          read_only: false
        - type: volume
          source: drupal-private-files
          target: /var/www/drupal/private
          read_only: false
        - ./drupal/rootfs/var/www/drupal/assets:/var/www/drupal/assets:z,rw,${CONSISTENCY}
        - ./drupal/rootfs/var/www/drupal/composer.json:/var/www/drupal/composer.json:z,rw,${CONSISTENCY}
        - ./drupal/rootfs/var/www/drupal/composer.lock:/var/www/drupal/composer.lock:z,rw,${CONSISTENCY}
        - ./drupal/rootfs/var/www/drupal/config:/var/www/drupal/config:z,rw,${CONSISTENCY}
        - ./drupal/rootfs/var/www/drupal/web/modules/custom:/var/www/drupal/web/modules/custom:z,rw,${CONSISTENCY}
        - ./drupal/rootfs/var/www/drupal/web/themes/custom:/var/www/drupal/web/themes/custom:z,rw,${CONSISTENCY}
        - drupal-solr-config:/opt/solr/server/solr/default:z,rw
    traefik:
      command:  >-
        --api.insecure=true
        --api.dashboard=true
        --api.debug=true
        --ping=true
        --entryPoints.http.address=:80
        --entryPoints.https.address=:443
        --entryPoints.https.transport.respondingTimeouts.readTimeout=60
        --providers.file.filename=/etc/traefik/tls.yml
        --providers.docker=true
        --providers.docker.network=default
        --providers.docker.exposedByDefault=false
      volumes: !override
        - /var/run/docker.sock:/var/run/docker.sock:z
        - ./certs:/etc/ssl/traefik:Z,ro
        - ./dev-tls.yml:/etc/traefik/tls.yml:Z,ro
